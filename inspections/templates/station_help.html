<!DOCTYPE html>
<html>
<head>
    <title>Station Detail</title>
</head>
<body>
    <h1>Station Detail for {{ station.name }}</h1>

    <h2>Gasoline Nozzles</h2>
    <table border="1">
        <tr>
            <th>Nozzle Number</th>
            <th>Start Totalizer</th>
            <th>End Totalizer</th>
            <th>Mechanical Sales</th>
        </tr>
        {% for nozzle in gasoline_nozzles %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ nozzle.start_totalizer }}</td>
            <td>{{ nozzle.end_totalizer }}</td>
            <td>{{ nozzle.mechanical_sales }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>Gas Nozzles</h2>
    <table border="1">
        <tr>
            <th>Nozzle Number</th>
            <th>Start Totalizer</th>
            <th>End Totalizer</th>
            <th>Mechanical Sales</th>
        </tr>
        {% for nozzle in gas_nozzles %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ nozzle.start_totalizer }}</td>
            <td>{{ nozzle.end_totalizer }}</td>
            <td>{{ nozzle.mechanical_sales }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>Gasoline Tanks</h2>
    <table border="1">
        <tr>
            <th>Tank Number</th>
            <th>Amount</th>
        </tr>
        {% for tank in gasoline_tanks %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ tank.amount }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>Gas Tanks</h2>
    <table border="1">
        <tr>
            <th>Tank Number</th>
            <th>Amount</th>
        </tr>
        {% for tank in gas_tanks %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ tank.amount }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>Details</h2>
    <ul>
        <li>Gasoline Mechanical Sales: {{ gasoline_mechanical_sales }}</li>
        <li>Gas Mechanical Sales: {{ gas_mechanical_sales }}</li>
        <li>Gasoline End Inventory: {{ gasoline_end_inventory }}</li>
        <li>Gas End Inventory: {{ gas_end_inventory }}</li>
        <li>Total Gasoline Inventory: {{ total_gasoline_inventory }}</li>
        <li>Total Gas Inventory: {{ total_gas_inventory }}</li>
        <li>Gasoline Outflow: {{ gasoline_outflow }}</li>
        <li>Gas Outflow: {{ gas_outflow }}</li>
        <li>Gasoline Difference: {{ gasoline_difference }}</li>
        <li>Gas Difference: {{ gas_difference }}</li>
        <li>Gasoline Status: {{ gasoline_status }}</li>
        <li>Gas Status: {{ gas_status }}</li>
        <li>Qire Mojaz: {{ qire_mojaz }}</li>
        <li>Electronic-Mechanical Discrepancy (Gasoline): {{ electronic_mechanical_discrepancy }}</li>
        <li>Electronic-Mechanical Discrepancy (Gas): {{ electronic_mechanical_discrepancy_gas }}</li>
    </ul>
</body>
</html>



def create_station(request):
    if request.method == 'POST':
        name = request.POST.get('name')
        
        gasoline_tanks = int(request.POST.get('gasoline_tanks', 0))
        gasoline_nozzles = int(request.POST.get('gasoline_nozzles', 0))
        
        gas_nozzles = int(request.POST.get('gas_nozzles', 0))
        gas_tanks = int(request.POST.get('gas_tanks', 0))
        
        gasoline_beginning = float(request.POST.get('gasoline_beginning', 0))
        gas_beginning = float(request.POST.get('gas_beginning', 0))
        
        gasoline_received = float(request.POST.get('gasoline_received', 0))
        gas_received = float(request.POST.get('gas_received', 0))
        
        electronic_gasoline_sales = float(request.POST.get('electronic_gasoline_sales', 0))
        electronic_gas_sales = float(request.POST.get('electronic_gas_sales', 0))
        
        start_date = request.POST.get('start_date')
        end_date = request.POST.get('end_date')
        controller = request.POST.get('controller')

        

        with transaction.atomic():
            station = FuelStation.objects.create(
                name=name,
                gasoline_tanks=gasoline_tanks,
                gas_tanks=gas_tanks,
                gasoline_nozzles=gasoline_nozzles,
                gas_nozzles=gas_nozzles,
                gasoline_beginning=gasoline_beginning,
                gas_beginning=gas_beginning,
                gasoline_received=gasoline_received,
                gas_received=gas_received,
                electronic_gasoline_sales=electronic_gasoline_sales,
                electronic_gas_sales=electronic_gas_sales,
                start_date=start_date,
                end_date=end_date,
                controller=controller
            )

            for i in range(1, gasoline_tanks + 1):
                amount = float(request.POST.get(f'gasoline_tank_{i}', 0))
                print(f"gasoline_tank_{i}: {amount}")  # Debugging print
                Tank.objects.create(station=station, type='gasoline', amount=amount)

            for i in range(1, gas_tanks + 1):
                amount = float(request.POST.get(f'gas_tank_{i}', 0))
                print(f"gas_tank_{i}: {amount}")  # Debugging print
                Tank.objects.create(station=station, type='gas', amount=amount)

            for i in range(1, gasoline_nozzles + 1):
                start_totalizer = float(request.POST.get(f'gasoline_nozzle_start_totalizer_{i}', 0))
                end_totalizer = float(request.POST.get(f'gasoline_nozzle_end_totalizer_{i}', 0))
                Nozzle.objects.create(station=station, type='gasoline', start_totalizer=start_totalizer, end_totalizer=end_totalizer)

            for i in range(1, gas_nozzles + 1):
                start_totalizer = float(request.POST.get(f'gas_nozzle_start_totalizer_{i}', 0))
                end_totalizer = float(request.POST.get(f'gas_nozzle_end_totalizer_{i}', 0))
                Nozzle.objects.create(station=station, type='gas', start_totalizer=start_totalizer, end_totalizer=end_totalizer)

        return redirect(reverse('station_detail', args=[station.id]))

    return render(request, 'create_station.html')